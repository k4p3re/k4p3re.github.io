---
title: "Attacktive Directory -  THM"
date: 2023-11-13 03:51:00 +03
categories: [AD Exploits]
tags: [AD-exploitation, pwn, win, main, vuln, p64, 64-bit ]
image: /assets/img/Posts/ad.png
---

> Welcome to a thrilling adventure into the intricate world of Active Directory security! In this blog post, we'll be delving into the immersive and hands-on experience offered by the Active Directory lab on TryHackMe. Whether you're a seasoned cybersecurity professional or a curious enthusiast eager to enhance your skills, this journey promises to unravel the mysteries of AD security in a practical, real-world environment.

## AD Pentest Toolset
Conducting a penetration test on an Active Directory (AD) environment requires a set of specialized tools to effectively assess its security. Here's a list of essential tools for an AD penetration test:

BloodHound:
Purpose: BloodHound is a powerful tool for visualizing and analyzing relationships within an Active Directory environment. It helps identify attack paths and potential security risks, making it an invaluable asset for penetration testers.

`enum4linux:`

enum4linux is a tool designed to enumerate information from Windows and Samba systems. It specifically focuses on gathering details from SMB (Server Message Block) services, providing insights into shares, users, and other information within an Active Directory environment.

`Neo4j:`

While not a traditional penetration testing tool, Neo4j can be useful in the context of analyzing and visualizing data relationships. In an Active Directory environment, tools like BloodHound often use graph databases like Neo4j to represent complex relationships between AD objects, helping penetration testers identify and understand attack paths.

`Mimikatz:`

This is a post-exploitation tool that allows penetration testers to extract plaintext passwords, hashes, and Kerberos tickets from memory, enabling the identification of potential security vulnerabilities.

`PowerShell Empire:`

PowerShell Empire is a post-exploitation framework that facilitates the deployment of agents on target systems. It allows testers to execute PowerShell-based payloads and perform various actions on compromised systems.

`PowerSploit:`

PowerSploit is a collection of Microsoft PowerShell scripts that aids penetration testers in post-exploitation activities. It includes modules for various tasks, such as privilege escalation, code execution, and credential theft.

`CrackMapExec (CME):`

CME is a post-exploitation tool that automates a variety of tasks in an Active Directory environment. It supports actions like lateral movement, execution of commands, and credential manipulation.

`Responder:`

Responder is a network analysis tool designed to capture and relay authentication requests. It helps identify and respond to Network NTLM challenges, making it useful for performing man-in-the-middle attacks in an AD environment.

`Impacket:`

Impacket is a collection of Python scripts for working with network protocols, including those used in Active Directory environments. It allows penetration testers to perform various tasks, such as relaying authentication, dumping credentials, and more.

`LDAP Enumeration Tools (e.g., ldapsearch, ldapenum):`

These tools are essential for enumerating information from LDAP services. Enumeration is a crucial step in understanding the structure of an Active Directory environment, including users, groups, and permissions.

`Nmap:`

Nmap is a versatile network scanning tool that can be used to discover hosts, open ports, and identify services within an Active Directory network. It helps in the initial reconnaissance phase of a penetration test.

`Veil Framework:`

Veil Framework is a collection of tools designed for generating and delivering payload executables for Windows environments. It aids in creating undetectable payloads for use in penetration tests.

`Aorato PTH Tool:`

This Pass-the-Hash (PTH) tool is designed to perform various actions using pass-the-hash attacks. It's particularly useful for testing the effectiveness of security measures against credential theft.

Let's dive into the challenge:
## Task 3: AD Enumeration
The goal of enumeration is to gather details about users, groups, computers, shares, and other objects within the AD infrastructure. Tools like enum4linux, ldapsearch, and custom PowerShell scripts are commonly used during the enumeration phase. Enumeration serves as the foundation for subsequent penetration testing activities, helping testers devise effective strategies for privilege escalation, lateral movement, and overall compromise. 

Our initial step in this machine is do an nmap scan on our target.

```shell
nmap -sVC [IP]
```
![image](https://github.com/k4p3re/k4p3re.github.io/assets/49836387/18ad8c9b-9ea4-428c-806d-1ad8aa816ad9)
1. What tool will allow us to enumerate port 139/445?
   
Ans: enum4linux
2. What is the NetBIOS-Domain Name of the machine?

This requires one to use the enum4linux tool to do enumeration in order to identify the NetBIOS-Domain name.

```shell
enum4linux [IP]
```
![image](https://github.com/k4p3re/k4p3re.github.io/assets/49836387/f3a1183c-22f4-4ce2-aa6e-40f5763357e7)

Ans: THM-AD
4. What invalid TLD do people commonly use for their Active Directory Domain?

A quick google search of an invalid TLD commonly used in non-production AD environments is the `.local

Ans: .local

## Task 4: Enumerating Users Using Keberos
Enumerating users via Kerberos involves leveraging the Kerberos authentication protocol to gather information about valid user accounts within an Active Directory (AD) environment. We will use a tool called kerbrute to bruteforce discovery of users, passwords and also password spray.
You can download the tool here: https://github.com/ropnop/kerbrute

Run the help section of the tool to see available arguments.
```shell
./kerbrute_linux_amd64 --help
```
![image](https://github.com/k4p3re/k4p3re.github.io/assets/49836387/9bbe429e-312e-42a9-8da9-c490c5703408)

What command within Kerbrute will allow us to enumerate valid usernames?

Ans: userenum

We now run the command to enumerate the machine.
```shell
./kerbrute_linux_and64 userenum --dc [IP] -d spookeysec.local <path_to_user_list>
```
![image](https://github.com/k4p3re/k4p3re.github.io/assets/49836387/d21e37d2-c2e4-40ed-bd33-df0070480196)

What notable account is discovered? (These should jump out at you)

Ans: svc-admin

What is the other notable account is discovered? (These should jump out at you)

Ans: backup

## Task 5: Abusing Kerberos


And we pwned the challenge !

Thanks for reading, Suggestions & Feedback are appreciated !
